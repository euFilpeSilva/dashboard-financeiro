<div class="despesa-list-container">
  <div class="header">
    <h2>ğŸ“‹ GestÃ£o de Despesas</h2>
    <button class="btn btn-primary" (click)="onNovaDespesa()">
      â• Nova Despesa
    </button>
  </div>

  <!-- SeÃ§Ã£o de Filtros e OrdenaÃ§Ã£o -->
  <div class="filtros-container">
    <div class="filtros-row">
      <!-- Filtros -->
      <div class="filtros-grupo">
        <h3>ğŸ” Filtros</h3>
        <div class="filtros-inputs">
          <div class="filtro-item">
            <label for="filtro-mes">MÃªs:</label>
            <select id="filtro-mes" [(ngModel)]="filtroMes" (change)="onFiltroMesChange()" class="filtro-select">
              <option *ngFor="let mes of mesesDisponiveis" [value]="mes.valor">{{ mes.nome }}</option>
            </select>
          </div>

          <div class="filtro-item">
            <label for="filtro-ano">Ano:</label>
            <select id="filtro-ano" [(ngModel)]="filtroAno" (change)="onFiltroAnoChange()" class="filtro-select">
              <option value="">Todos os anos</option>
              <option *ngFor="let ano of anosDisponiveis" [value]="ano">{{ ano || 'Todos os anos' }}</option>
            </select>
          </div>

          <div class="filtro-item">
            <label for="filtro-status">Status:</label>
            <select id="filtro-status" [(ngModel)]="filtroStatus" (change)="onFiltroStatusChange()" class="filtro-select">
              <option value="todos">Todas</option>
              <option value="pendentes">Pendentes</option>
              <option value="pagas">Pagas</option>
              <option value="vencidas">Vencidas</option>
            </select>
          </div>
        </div>
      </div>

      <!-- OrdenaÃ§Ã£o -->
      <div class="ordenacao-grupo">
        <h3>ğŸ“Š OrdenaÃ§Ã£o</h3>
        <div class="ordenacao-inputs">
          <div class="filtro-item">
            <label for="ordenacao">Ordenar por:</label>
            <select id="ordenacao" [(ngModel)]="ordenacao" (change)="onOrdenacaoChange()" class="filtro-select">
              <option value="vencimento">Data de Vencimento</option>
              <option value="valor">Valor</option>
              <option value="descricao">DescriÃ§Ã£o</option>
              <option value="categoria">Categoria</option>
            </select>
          </div>

          <div class="filtro-item">
            <button class="btn btn-ordenacao" (click)="toggleDirecaoOrdenacao()" 
                    [title]="direcaoOrdenacao === 'asc' ? 'Crescente' : 'Decrescente'">
              {{ direcaoOrdenacao === 'asc' ? 'â¬†ï¸' : 'â¬‡ï¸' }}
              {{ direcaoOrdenacao === 'asc' ? 'Crescente' : 'Decrescente' }}
            </button>
          </div>
        </div>
      </div>

      <!-- BotÃ£o Limpar -->
      <div class="acoes-grupo">
        <!-- Toggle de Modo de VisualizaÃ§Ã£o -->
        <div class="modo-visualizacao">
          <h3>ğŸ‘ï¸ VisualizaÃ§Ã£o</h3>
          <div class="view-toggle">
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'grade'"
              (click)="alterarModoVisualizacao('grade')"
              title="VisualizaÃ§Ã£o em Grade">
              ğŸŸ« Grade
            </button>
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'lista'"
              (click)="alterarModoVisualizacao('lista')"
              title="VisualizaÃ§Ã£o em Lista">
              ğŸ“‹ Lista
            </button>
          </div>
        </div>

        <button class="btn btn-limpar" (click)="limparFiltros()">
          ğŸ—‘ï¸ Limpar Filtros
        </button>
        <div class="contador-resultados">
          <span>{{ getTotalDespesasFiltradas() }} de {{ despesas.length }} despesas</span>
        </div>
      </div>
    </div>
  </div>

  <!-- VisualizaÃ§Ã£o em Grade -->
  <div *ngIf="modoVisualizacao === 'grade'" class="despesas-grid">
    <!-- Mensagem quando nÃ£o hÃ¡ despesas filtradas -->
    <div *ngIf="despesasFiltradas.length === 0 && despesas.length > 0" class="no-results">
      <div class="no-results-content">
        <span class="no-results-icon">ğŸ”</span>
        <h3>Nenhuma despesa encontrada</h3>
        <p>Tente ajustar os filtros para encontrar despesas.</p>
        <button class="btn btn-primary" (click)="limparFiltros()">
          Limpar Filtros
        </button>
      </div>
    </div>

    <div *ngFor="let despesa of despesasFiltradas; trackBy: trackByDespesa" 
         class="despesa-card"
         [ngClass]="{
           'vencida': isVencida(despesa),
           'proxima-vencimento': isProximaVencimento(despesa),
           'paga': despesa.paga
         }">
      
      <!-- Status e Categoria -->
      <div class="card-header">
        <div class="categoria-info">
          <span class="categoria-icon">{{ despesa.categoria.icon }}</span>
          <span class="categoria-nome">{{ despesa.categoria.nome }}</span>
        </div>
        <div class="status-badges">
          <span class="prioridade-badge" [ngClass]="getPrioridadeClass(despesa.prioridade)">
            {{ despesa.prioridade }}
          </span>
          <span *ngIf="despesa.paga" class="status-badge paga">âœ… Paga</span>
          <span *ngIf="isVencida(despesa)" class="status-badge vencida">âš ï¸ Vencida</span>
          <span *ngIf="isProximaVencimento(despesa)" class="status-badge proxima">ğŸ”” PrÃ³xima</span>
        </div>
      </div>

      <!-- InformaÃ§Ãµes principais -->
      <div class="card-body">
        <h3 class="despesa-descricao">{{ despesa.descricao }}</h3>
        <p class="despesa-valor">{{ formatarMoeda(despesa.valor) }}</p>
        <p class="despesa-vencimento">
          ğŸ“… Vence em: {{ formatarData(despesa.dataVencimento) }}
        </p>
        <p *ngIf="despesa.paga && despesa.dataPagamento" class="despesa-pagamento">
          âœ… Pago em: {{ formatarData(despesa.dataPagamento) }}
        </p>
      </div>

      <!-- AÃ§Ãµes -->
      <div class="card-actions">
        <button 
          class="btn btn-toggle"
          [ngClass]="despesa.paga ? 'btn-unpay' : 'btn-pay'"
          (click)="onTogglePaga(despesa)"
          [title]="despesa.paga ? 'Marcar como pendente' : 'Marcar como paga'">
          {{ despesa.paga ? 'â†©ï¸' : 'âœ…' }}
        </button>
        
        <button 
          class="btn btn-edit"
          (click)="onEditarDespesa(despesa)"
          title="Editar despesa">
          âœï¸
        </button>
        
        <button 
          class="btn btn-delete"
          (click)="onRemoverDespesa(despesa.id)"
          title="Remover despesa">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>

    <!-- Card para adicionar nova despesa -->
    <div class="despesa-card add-card" (click)="onNovaDespesa()">
      <div class="add-content">
        <div class="add-icon">â•</div>
        <p>Adicionar Nova Despesa</p>
      </div>
    </div>
  </div>

  <!-- VisualizaÃ§Ã£o em Lista -->
  <div *ngIf="modoVisualizacao === 'lista'" class="despesas-lista">
    <!-- Mensagem quando nÃ£o hÃ¡ despesas filtradas -->
    <div *ngIf="despesasFiltradas.length === 0 && despesas.length > 0" class="no-results">
      <div class="no-results-content">
        <span class="no-results-icon">ğŸ”</span>
        <h3>Nenhuma despesa encontrada</h3>
        <p>Tente ajustar os filtros para encontrar despesas.</p>
        <button class="btn btn-primary" (click)="limparFiltros()">
          Limpar Filtros
        </button>
      </div>
    </div>

    <!-- CabeÃ§alho da Lista -->
    <div *ngIf="despesasFiltradas.length > 0" class="lista-header">
      <div class="header-col col-categoria">Categoria</div>
      <div class="header-col col-descricao">DescriÃ§Ã£o</div>
      <div class="header-col col-valor">Valor</div>
      <div class="header-col col-vencimento">Vencimento</div>
      <div class="header-col col-prioridade">Prioridade</div>
      <div class="header-col col-status">Status</div>
      <div class="header-col col-acoes">AÃ§Ãµes</div>
    </div>

    <!-- Linhas da Lista -->
    <div class="lista-body">
      <div *ngFor="let despesa of despesasFiltradas; trackBy: trackByDespesa" 
           class="despesa-row"
           [ngClass]="{
             'vencida': isVencida(despesa),
             'proxima-vencimento': isProximaVencimento(despesa),
             'paga': despesa.paga
           }">
        
        <!-- Categoria -->
        <div class="row-col col-categoria">
          <div class="categoria-compact">
            <span class="categoria-icon-small" [style.background]="despesa.categoria.cor">
              {{ despesa.categoria.icon }}
            </span>
            <span class="categoria-nome-small">{{ despesa.categoria.nome }}</span>
          </div>
        </div>

        <!-- DescriÃ§Ã£o -->
        <div class="row-col col-descricao">
          <div class="despesa-descricao-compact">{{ despesa.descricao }}</div>
        </div>

        <!-- Valor -->
        <div class="row-col col-valor">
          <div class="valor-compact">{{ formatarMoeda(despesa.valor) }}</div>
        </div>

        <!-- Vencimento -->
        <div class="row-col col-vencimento">
          <div class="vencimento-compact" 
               [ngClass]="{
                 'vencimento-normal': !despesa.paga && !isVencida(despesa) && !isProximaVencimento(despesa),
                 'vencimento-proximo': !despesa.paga && isProximaVencimento(despesa),
                 'vencimento-atrasado': !despesa.paga && isVencida(despesa),
                 'vencimento-pago': despesa.paga
               }">
            {{ formatarData(despesa.dataVencimento) }}
          </div>
        </div>

        <!-- Prioridade -->
        <div class="row-col col-prioridade">
          <span class="prioridade-compact" [ngClass]="getPrioridadeClass(despesa.prioridade)">
            {{ despesa.prioridade }}
          </span>
        </div>

        <!-- Status -->
        <div class="row-col col-status">
          <button 
            class="status-toggle-compact"
            [ngClass]="despesa.paga ? 'pago' : 'pendente'"
            (click)="onTogglePaga(despesa)"
            [title]="despesa.paga ? 'Marcar como pendente' : 'Marcar como paga'">
            <span class="status-icon-compact">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
          </button>
        </div>

        <!-- AÃ§Ãµes -->
        <div class="row-col col-acoes">
          <div class="acoes-compact">
            <button 
              class="action-btn-compact edit-btn"
              (click)="onEditarDespesa(despesa)"
              title="Editar despesa">
              âœï¸
            </button>
            
            <button 
              class="action-btn-compact delete-btn"
              (click)="onRemoverDespesa(despesa.id)"
              title="Remover despesa">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- BotÃ£o adicionar na visualizaÃ§Ã£o lista -->
    <div class="add-despesa-lista">
      <button class="btn btn-primary btn-add-lista" (click)="onNovaDespesa()">
        â• Adicionar Nova Despesa
      </button>
    </div>
  </div>

  <!-- Resumo -->
  <div class="resumo-section">
    <div class="resumo-card">
      <h3>ğŸ“Š Resumo</h3>
      <div class="resumo-stats">
        <div class="stat">
          <span class="stat-label">Total de Despesas:</span>
          <span class="stat-value">{{ getTotalDespesasFiltradas() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Pagas:</span>
          <span class="stat-value green">{{ getDespesasPagas() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Pendentes:</span>
          <span class="stat-value orange">{{ getDespesasPendentes() }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Valor Total:</span>
          <span class="stat-value">{{ formatarMoeda(getTotalDespesas()) }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal do formulÃ¡rio -->
<app-despesa-form
  [isVisible]="showForm"
  [despesa]="despesaEditando"
  (onSave)="onSalvarDespesa($event)"
  (onCancel)="onCancelarForm()">
</app-despesa-form>
