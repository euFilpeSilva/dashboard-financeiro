<div class="gestao-container">
  <!-- Header -->
  <div class="gestao-header">
    <div class="header-content">
      <button class="btn-back" (click)="voltarDashboard()">
        â† Voltar ao Dashboard
      </button>
      <h1>ğŸ’¼ GestÃ£o Financeira</h1>
      <p>Gerencie suas entradas e despesas de forma completa</p>
    </div>
  </div>

  <!-- NavegaÃ§Ã£o por Abas -->
  <div class="tabs-container">
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="abaAtiva === 'despesas'"
        (click)="alterarAba('despesas')">
        ğŸ’¸ Despesas ({{ despesas.length }})
      </button>
      <button 
        class="tab" 
        [class.active]="abaAtiva === 'entradas'"
        (click)="alterarAba('entradas')">
        ğŸ’° Entradas ({{ entradas.length }})
      </button>
    </div>
  </div>

  <!-- ConteÃºdo das Abas -->
  <div class="tab-content">
    
    <!-- ABA DESPESAS -->
    <div *ngIf="abaAtiva === 'despesas'" class="content-section">
      <div class="section-header">
        <h2>ğŸ“‹ Lista de Despesas</h2>
        <div class="header-actions">
          <div class="view-toggle">
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'grade'"
              (click)="alterarModoVisualizacao('grade')"
              title="VisualizaÃ§Ã£o em Grade">
              âŠ Grade
            </button>
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'lista'"
              (click)="alterarModoVisualizacao('lista')"
              title="VisualizaÃ§Ã£o em Lista">
              â˜° Lista
            </button>
          </div>
          <button class="btn btn-primary" (click)="abrirFormularioDespesa()">
            â• Nova Despesa
          </button>
        </div>
      </div>

      <!-- Controles de Filtro -->
      <div class="filtros-container">
        <div class="filtros-row">
          <!-- Busca -->
          <div class="filtro-group">
            <label>ğŸ” Buscar:</label>
            <input 
              type="text" 
              [(ngModel)]="termoBusca" 
              (input)="buscar()"
              placeholder="DescriÃ§Ã£o ou categoria..."
              class="input-busca">
          </div>

          <!-- Status -->
          <div class="filtro-group">
            <label>Status:</label>
            <select [(ngModel)]="filtroStatusDespesa" (change)="aplicarFiltros()" class="select-filtro">
              <option *ngFor="let opcao of opcoesStatus" [value]="opcao.value">
                {{ opcao.label }}
              </option>
            </select>
          </div>

          <!-- Prioridade -->
          <div class="filtro-group">
            <label>Prioridade:</label>
            <select [(ngModel)]="filtroPrioridade" (change)="aplicarFiltros()" class="select-filtro">
              <option *ngFor="let opcao of opcoesPrioridade" [value]="opcao.value">
                {{ opcao.label }}
              </option>
            </select>
          </div>

          <!-- Categoria -->
          <div class="filtro-group">
            <label>Categoria:</label>
            <select [(ngModel)]="filtroCategoria" (change)="aplicarFiltros()" class="select-filtro">
              <option value="todas">ğŸ·ï¸ Todas</option>
              <option *ngFor="let categoria of categorias" [value]="categoria.id">
                {{ categoria.icon }} {{ categoria.nome }}
              </option>
            </select>
          </div>
        </div>

        <div class="filtros-row">
          <!-- OrdenaÃ§Ã£o -->
          <div class="filtro-group">
            <label>Ordenar por:</label>
            <select [(ngModel)]="ordenacaoAtual" (change)="alterarOrdenacao(ordenacaoAtual)" class="select-filtro">
              <option *ngFor="let opcao of opcoesOrdenacao" [value]="opcao.value">
                {{ opcao.label }}
              </option>
            </select>
          </div>

          <!-- DireÃ§Ã£o -->
          <div class="filtro-group">
            <label>DireÃ§Ã£o:</label>
            <button 
              class="btn-direcao" 
              (click)="alterarOrdenacao(ordenacaoAtual)"
              title="Alterar direÃ§Ã£o da ordenaÃ§Ã£o">
              {{ direcaoOrdenacao === 'desc' ? 'â†“ Desc' : 'â†‘ Asc' }}
            </button>
          </div>

          <!-- Total -->
          <div class="filtro-group">
            <span class="total-itens">
              {{ despesas.length }} de {{ despesasOriginais.length }} despesas
            </span>
          </div>

          <!-- Limpar filtros -->
          <div class="filtro-group">
            <button class="btn-limpar" (click)="limparFiltros()" title="Limpar todos os filtros">
              ğŸ—‘ï¸ Limpar
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="carregandoDespesas" class="loading-state">
        <div class="spinner"></div>
        <p>Carregando despesas...</p>
      </div>

      <!-- Lista de Despesas -->
      <div *ngIf="!carregandoDespesas" class="items-container">
        <div *ngIf="despesas.length === 0" class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h3>Nenhuma despesa encontrada</h3>
          <p *ngIf="termoBusca || filtroStatusDespesa !== 'todas' || filtroPrioridade !== 'todas' || filtroCategoria !== 'todas'">
            Tente ajustar os filtros ou adicionar uma nova despesa
          </p>
          <p *ngIf="!termoBusca && filtroStatusDespesa === 'todas' && filtroPrioridade === 'todas' && filtroCategoria === 'todas'">
            Comece adicionando sua primeira despesa
          </p>
          <button class="btn btn-primary" (click)="abrirFormularioDespesa()">
            â• Adicionar Despesa
          </button>
        </div>

        <!-- VisualizaÃ§Ã£o em Grade -->
        <div *ngIf="despesas.length > 0 && modoVisualizacao === 'grade'" class="items-grid">
          <div *ngFor="let despesa of despesas" class="item-card" [class]="getStatusClass(despesa)">
            <div class="item-header">
              <div class="item-info">
                <h3>{{ despesa.descricao }}</h3>
                <div class="item-meta">
                  <span class="categoria">
                    {{ despesa.categoria.icon }} {{ despesa.categoria.nome }}
                  </span>
                  <span class="prioridade" [class]="getPrioridadeClass(despesa.prioridade)">
                    {{ getPrioridadeTexto(despesa.prioridade) }}
                  </span>
                </div>
              </div>
              <div class="item-actions">
                <button class="btn-action btn-edit" (click)="abrirFormularioDespesa(despesa)" title="Editar">
                  âœï¸
                </button>
                <button class="btn-action btn-delete" (click)="excluirDespesa(despesa)" title="Excluir">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>

            <div class="item-details">
              <div class="detail-row">
                <span class="label">Valor:</span>
                <span class="value valor">{{ formatarMoeda(despesa.valor) }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Vencimento:</span>
                <span class="value">{{ formatarData(despesa.dataVencimento) }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Status:</span>
                <button 
                  class="btn-status" 
                  [class.pago]="despesa.paga"
                  (click)="toggleStatusDespesa(despesa)">
                  {{ despesa.paga ? 'âœ… Pago' : 'â³ Pendente' }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- VisualizaÃ§Ã£o em Lista -->
        <div *ngIf="despesas.length > 0 && modoVisualizacao === 'lista'" class="items-lista">
          <!-- CabeÃ§alho da Lista -->
          <div class="lista-header">
            <div class="header-col">DescriÃ§Ã£o</div>
            <div class="header-col">Categoria</div>
            <div class="header-col">Valor</div>
            <div class="header-col">Vencimento</div>
            <div class="header-col">Status</div>
            <div class="header-col">AÃ§Ãµes</div>
          </div>
          
          <!-- Corpo da Lista -->
          <div class="lista-body">
            <div *ngFor="let despesa of despesas" class="lista-item" [class]="getStatusClass(despesa)">
              <div class="item-field">
                <div class="field-label">DescriÃ§Ã£o</div>
                <div class="field-value">
                  <strong>{{ despesa.descricao }}</strong>
                  <span class="prioridade-badge" [class]="getPrioridadeClass(despesa.prioridade)">
                    {{ getPrioridadeTexto(despesa.prioridade) }}
                  </span>
                </div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Categoria</div>
                <div class="field-value">{{ despesa.categoria.icon }} {{ despesa.categoria.nome }}</div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Valor</div>
                <div class="field-value valor negativo">{{ formatarMoeda(despesa.valor) }}</div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Vencimento</div>
                <div class="field-value">{{ formatarData(despesa.dataVencimento) }}</div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Status</div>
                <div class="field-value">
                  <button 
                    class="status-badge" 
                    [class.pago]="despesa.paga"
                    (click)="toggleStatusDespesa(despesa)">
                    {{ despesa.paga ? 'âœ…' : 'â³' }}
                  </button>
                </div>
              </div>
              
              <div class="item-actions">
                <button class="btn-action editar" (click)="abrirFormularioDespesa(despesa)" title="Editar">âœï¸</button>
                <button class="btn-action excluir" (click)="excluirDespesa(despesa)" title="Excluir">ğŸ—‘ï¸</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA ENTRADAS -->
    <div *ngIf="abaAtiva === 'entradas'" class="content-section">
      <div class="section-header">
        <h2>ğŸ“ˆ Lista de Entradas</h2>
        <div class="header-actions">
          <div class="view-toggle">
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'grade'"
              (click)="alterarModoVisualizacao('grade')"
              title="VisualizaÃ§Ã£o em Grade">
              âŠ Grade
            </button>
            <button 
              class="toggle-btn" 
              [class.active]="modoVisualizacao === 'lista'"
              (click)="alterarModoVisualizacao('lista')"
              title="VisualizaÃ§Ã£o em Lista">
              â˜° Lista
            </button>
          </div>
          <button class="btn btn-primary" (click)="abrirFormularioEntrada()">
            â• Nova Entrada
          </button>
        </div>
      </div>

      <!-- Controles de Filtro para Entradas -->
      <div class="filtros-container">
        <div class="filtros-row">
          <!-- Busca -->
          <div class="filtro-group">
            <label>ğŸ” Buscar:</label>
            <input 
              type="text" 
              [(ngModel)]="termoBusca" 
              (input)="buscar()"
              placeholder="DescriÃ§Ã£o ou fonte..."
              class="input-busca">
          </div>

          <!-- Fonte -->
          <div class="filtro-group">
            <label>Fonte:</label>
            <select [(ngModel)]="filtroFonte" (change)="aplicarFiltrosEntradas()" class="select-filtro">
              <option value="todas">ğŸ’° Todas</option>
              <option *ngFor="let fonte of fontes" [value]="fonte">
                {{ fonte }}
              </option>
            </select>
          </div>

          <!-- OrdenaÃ§Ã£o -->
          <div class="filtro-group">
            <label>Ordenar por:</label>
            <select [(ngModel)]="ordenacaoAtual" (change)="alterarOrdenacao(ordenacaoAtual)" class="select-filtro">
              <option *ngFor="let opcao of opcoesOrdenacao" [value]="opcao.value">
                {{ opcao.label }}
              </option>
            </select>
          </div>

          <!-- DireÃ§Ã£o -->
          <div class="filtro-group">
            <label>DireÃ§Ã£o:</label>
            <button 
              class="btn-direcao" 
              (click)="alterarOrdenacao(ordenacaoAtual)"
              title="Alterar direÃ§Ã£o da ordenaÃ§Ã£o">
              {{ direcaoOrdenacao === 'desc' ? 'â†“ Desc' : 'â†‘ Asc' }}
            </button>
          </div>

          <!-- Total -->
          <div class="filtro-group">
            <span class="total-itens">
              {{ entradas.length }} de {{ entradasOriginais.length }} entradas
            </span>
          </div>

          <!-- Limpar filtros -->
          <div class="filtro-group">
            <button class="btn-limpar" (click)="limparFiltros()" title="Limpar todos os filtros">
              ğŸ—‘ï¸ Limpar
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="carregandoEntradas" class="loading-state">
        <div class="spinner"></div>
        <p>Carregando entradas...</p>
      </div>

      <!-- Lista de Entradas -->
      <div *ngIf="!carregandoEntradas" class="items-container">
        <div *ngIf="entradas.length === 0" class="empty-state">
          <div class="empty-icon">ğŸ’°</div>
          <h3>Nenhuma entrada encontrada</h3>
          <p *ngIf="termoBusca || filtroFonte !== 'todas'">
            Tente ajustar os filtros ou adicionar uma nova entrada
          </p>
          <p *ngIf="!termoBusca && filtroFonte === 'todas'">
            Comece adicionando sua primeira entrada
          </p>
          <button class="btn btn-primary" (click)="abrirFormularioEntrada()">
            â• Adicionar Entrada
          </button>
        </div>

        <!-- VisualizaÃ§Ã£o em Grade -->
        <div *ngIf="entradas.length > 0 && modoVisualizacao === 'grade'" class="items-grid">
          <div *ngFor="let entrada of entradas" class="item-card entrada-card">
            <div class="item-header">
              <div class="item-info">
                <h3>{{ entrada.descricao }}</h3>
                <div class="item-meta">
                  <span class="fonte">{{ entrada.fonte }}</span>
                </div>
              </div>
              <div class="item-actions">
                <button class="btn-action btn-edit" (click)="abrirFormularioEntrada(entrada)" title="Editar">
                  âœï¸
                </button>
                <button class="btn-action btn-delete" (click)="excluirEntrada(entrada)" title="Excluir">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>

            <div class="item-details">
              <div class="detail-row">
                <span class="label">Valor:</span>
                <span class="value valor entrada-valor">{{ formatarMoeda(entrada.valor) }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Data:</span>
                <span class="value">{{ formatarData(entrada.data) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- VisualizaÃ§Ã£o em Lista -->
        <div *ngIf="entradas.length > 0 && modoVisualizacao === 'lista'" class="items-lista entradas-lista">
          <!-- CabeÃ§alho da Lista -->
          <div class="lista-header">
            <div class="header-col">DescriÃ§Ã£o</div>
            <div class="header-col">Fonte</div>
            <div class="header-col">Valor</div>
            <div class="header-col">Data</div>
            <div class="header-col">AÃ§Ãµes</div>
          </div>
          
          <!-- Corpo da Lista -->
          <div class="lista-body">
            <div *ngFor="let entrada of entradas" class="lista-item entrada-card">
              <div class="item-field">
                <div class="field-label">DescriÃ§Ã£o</div>
                <div class="field-value">
                  <strong>{{ entrada.descricao }}</strong>
                </div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Fonte</div>
                <div class="field-value">{{ entrada.fonte }}</div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Valor</div>
                <div class="field-value valor positivo">{{ formatarMoeda(entrada.valor) }}</div>
              </div>
              
              <div class="item-field">
                <div class="field-label">Data</div>
                <div class="field-value">{{ formatarData(entrada.data) }}</div>
              </div>
              
              <div class="item-actions">
                <button class="btn-action editar" (click)="abrirFormularioEntrada(entrada)" title="Editar">âœï¸</button>
                <button class="btn-action excluir" (click)="excluirEntrada(entrada)" title="Excluir">ğŸ—‘ï¸</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FormulÃ¡rios Modais -->
<app-despesa-form
  [isVisible]="showDespesaForm"
  [despesa]="despesaEditando"
  (onSave)="salvarDespesa($event)"
  (onCancel)="fecharFormularioDespesa()">
</app-despesa-form>

<app-entrada-form
  [isVisible]="showEntradaForm"
  [entrada]="entradaEditando"
  (onSave)="salvarEntrada($event)"
  (onCancel)="fecharFormularioEntrada()">
</app-entrada-form>

<!-- Modal de ConfirmaÃ§Ã£o -->
<app-confirmation-modal
  [isVisible]="showConfirmationModal"
  [title]="confirmationData.title"
  [message]="confirmationData.message"
  [confirmText]="confirmationData.confirmText"
  [cancelText]="confirmationData.cancelText"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-modal>