<div class="dashboard-container" [attr.data-theme]="currentTheme">
  
  <!-- Layout CustomizÃ¡vel (Draggable/Widgets) -->
  <div *ngIf="currentTheme === 'customizavel' && !showDadosMensais" class="layout-container layout-customizavel">
    <app-customizable-layout></app-customizable-layout>
  </div>

  <!-- Layout Compacto (Status Bar + Grid) -->
  <div *ngIf="currentTheme === 'compacto' && !showDadosMensais" class="layout-container layout-compacto">
    <!-- Status bar compacto -->
    <div class="compact-status-bar">
      <div class="status-metrics">
        <div class="metric entrada">
          <span class="metric-icon">ğŸ’°</span>
          <span class="metric-value">{{ formatarMoeda(resumo.totalEntradas) }}</span>
          <span class="metric-label">Entradas</span>
        </div>
        <div class="metric despesa">
          <span class="metric-icon">ğŸ’¸</span>
          <span class="metric-value">{{ formatarMoeda(resumo.totalDespesas) }}</span>
          <span class="metric-label">Despesas</span>
        </div>
        <div class="metric saldo">
          <span class="metric-icon">ğŸ“Š</span>
          <span class="metric-value" [ngClass]="getSaldoClass()">{{ formatarMoeda(resumo.saldoPrevisto) }}</span>
          <span class="metric-label">Saldo</span>
        </div>
        <div class="metric alert" *ngIf="despesasVencidas.length > 0">
          <span class="metric-icon">âš ï¸</span>
          <span class="metric-value">{{ despesasVencidas.length }}</span>
          <span class="metric-label">Vencidas</span>
        </div>
      </div>
      <div class="status-actions">
        <button class="compact-btn primary" (click)="irParaGestao()">+ Nova</button>
        <button class="compact-btn secondary" (click)="mostrarDadosMensais()">Detalhes</button>
      </div>
    </div>

    <!-- Period selector for compact layout -->
    <div class="compact-period-controls" style="display:flex;align-items:center;justify-content:flex-end;padding:6px 12px;gap:12px;">
      <label style="font-size:12px;color:var(--muted);">PerÃ­odo:</label>
      <select [(ngModel)]="selectedPeriodMonths" (change)="onPeriodChange()" class="select-period-compact">
        <option *ngFor="let opt of periodOptions" [value]="opt.value">{{ opt.label }}</option>
      </select>
      <div style="display:flex;gap:12px;align-items:center;">
        <div style="text-align:right">
          <div style="font-size:11px;color:var(--muted);">Despesas</div>
          <div style="font-weight:700">{{ formatarMoeda(periodMetrics.despesas || 0) }}</div>
        </div>
        <div *ngIf="periodMetrics.topCategoryName" style="text-align:right">
          <div style="font-size:11px;color:var(--muted);">Maior</div>
          <div style="font-weight:700">{{ periodMetrics.topCategoryName }}</div>
        </div>
      </div>
    </div>

    <!-- Grid compacto principal -->
    <div class="compact-layout">
      
      <!-- NOVO LAYOUT MOBILE OTIMIZADO -->
      <div class="mobile-layout">
        
        <!-- 1. MÃ©tricas compactas -->
        <div class="mobile-metrics">
          <div class="metric-card">
            <div class="metric-number">{{ despesasDoMes.length }}</div>
            <div class="metric-label">Despesas</div>
          </div>
          <div class="metric-card">
            <div class="metric-number">{{ entradasDoMes.length }}</div>
            <div class="metric-label">Entradas</div>
          </div>
          <div class="metric-card">
            <div class="metric-number">{{ resumo.despesasPagas }}</div>
            <div class="metric-label">Pagas</div>
          </div>
          <div class="metric-card">
            <div class="metric-number">{{ despesasVencidas.length }}</div>
            <div class="metric-label">Vencidas</div>
          </div>
        </div>

        <!-- Modal: lista completa de alertas -->
        <div class="alerts-modal-overlay" *ngIf="showAlertsModal" (click)="closeAlertsModal()">
          <div class="alerts-modal" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" aria-label="Lista completa de alertas">
            <div class="alerts-modal-header">
              <h4>Todos os Alertas</h4>
              <button class="btn btn-icon" (click)="closeAlertsModal()" aria-label="Fechar">âœ•</button>
            </div>
            <div class="alerts-modal-body">
              <div *ngIf="despesasVencidas.length > 0">
                <h5>Vencidas</h5>
                <div *ngFor="let d of despesasVencidas" class="alert-item vencida">
                  <span class="alert-emoji">ğŸ”´</span>
                  <div class="alert-info">
                    <span class="alert-desc">{{ d.descricao }}</span>
                    <span class="alert-date">Venceu {{ getDiasVencimento(d) }}</span>
                  </div>
                  <span class="alert-amount">{{ formatarMoeda(d.valor) }}</span>
                </div>
              </div>

              <div *ngIf="despesasProximasVencimento.length > 0" style="margin-top:12px">
                <h5>PrÃ³ximas do vencimento</h5>
                <div *ngFor="let d of despesasProximasVencimento" class="alert-item proxima">
                  <span class="alert-emoji">ğŸŸ¡</span>
                  <div class="alert-info">
                    <span class="alert-desc">{{ d.descricao }}</span>
                    <span class="alert-date">Vence {{ getDiasParaVencimento(d) }}</span>
                  </div>
                  <span class="alert-amount">{{ formatarMoeda(d.valor) }}</span>
                </div>
              </div>

              <div style="margin-top:12px">
                <h5>Metas</h5>
                <div class="alert-item meta" [ngClass]="{ 'exceeded': getPercentualMetaUsada() >= 100 }">
                  <span class="alert-emoji">ğŸ“Š</span>
                  <div class="alert-info">
                    <span class="alert-desc">Meta geral: {{ gastoMetaPercentualGeral }}% â€” R$ {{ formatarMoeda(getMetaBudgetValor()) }}</span>
                    <span class="alert-date">Gasto atual: {{ formatarMoeda(resumo.totalDespesas) }} â€” {{ getPercentualMetaUsada() }}% da meta</span>
                  </div>
                  <span class="alert-amount">{{ formatarMoeda(resumo.totalDespesas) }}</span>
                </div>

                <div class="alert-item meta" style="margin-top:8px" [ngClass]="{ 'exceeded': getPercentualMetaUsadaMesAtual() >= 100 }">
                  <span class="alert-emoji">ğŸ—“ï¸</span>
                  <div class="alert-info">
                    <span class="alert-desc">Meta do mÃªs ({{ formatMonth(gastoMetaMesReferencia) }}): {{ gastoMetaPercentualMensal }}% â€” R$ {{ formatarMoeda(getMetaValorMesAtual()) }}</span>
                    <span class="alert-date">Gasto atual (mÃªs): {{ formatarMoeda(getGastosDoMesTotal()) }} â€” {{ getPercentualMetaUsadaMesAtual() }}% da meta</span>
                  </div>
                  <span class="alert-amount">{{ formatarMoeda(getGastosDoMesTotal()) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 2. Lista de despesas otimizada -->
        <div class="mobile-despesas">
          <div class="mobile-header">
            <h4>ğŸ“‹ Despesas</h4>
            <span class="count-badge">{{ despesasDoMes.length }}</span>
          </div>
          <div class="mobile-list">
            <div *ngFor="let despesa of despesasDoMes.slice(0, 6)" 
                 class="mobile-item" 
                 [ngClass]="getDespesaStatusClass(despesa)">
              <div class="item-info">
                <span class="item-icon">{{ despesa.categoria.icon }}</span>
                <div class="item-details">
                  <div class="item-name">{{ despesa.descricao }}</div>
                  <div class="item-status">
                    Vence: {{ despesa.dataVencimento | date:'dd/MM' }} 
                    - {{ despesa.paga ? 'Paga' : 'Pendente' }}
                  </div>
                </div>
              </div>
              <div class="item-value">{{ formatarMoeda(despesa.valor) }}</div>
            </div>
          </div>
        </div>
        
        <!-- 3. Alertas compactos -->
        <div class="mobile-alerts" *ngIf="despesasVencidas.length > 0 || despesasProximasVencimento.length > 0">
          <div class="alerts-header">
            <div class="alerts-title">âš ï¸ Alertas</div>
            <div class="alerts-count">{{ despesasVencidas.length + despesasProximasVencimento.length }}</div>
          </div>
          <div class="alerts-list">
            <div *ngFor="let despesa of despesasVencidas.slice(0, 2)" class="alert-item">
              <div class="alert-icon">ğŸ”´</div>
              <div class="alert-content">
                <div class="alert-text">{{ despesa.descricao }}</div>
                <div class="alert-date">Venceu em {{ despesa.dataVencimento | date:'dd/MM' }}</div>
              </div>
              <div class="alert-amount">{{ formatarMoeda(despesa.valor) }}</div>
            </div>
            <div *ngFor="let despesa of despesasProximasVencimento.slice(0, 2)" class="alert-item">
              <div class="alert-icon">ğŸŸ¡</div>
              <div class="alert-content">
                <div class="alert-text">{{ despesa.descricao }}</div>
                <div class="alert-date">Vence em {{ despesa.dataVencimento | date:'dd/MM' }}</div>
              </div>
              <div class="alert-amount">{{ formatarMoeda(despesa.valor) }}</div>
            </div>
          </div>
        </div>
        
        <!-- 4. GrÃ¡fico otimizado para mobile -->
        <div class="mobile-chart">
          <div class="chart-header">
            <h4>ğŸ“Š DistribuiÃ§Ã£o de Despesas</h4>
          </div>
          <div class="chart-container">
            <app-chart [despesasPorCategoria]="despesasPorCategoria" chartType="doughnut"></app-chart>
          </div>
        </div>
        
        <!-- 5. Entradas compactas -->
        <div class="mobile-entradas" *ngIf="entradasDoMes.length > 0">
          <div class="entradas-header">
            <div class="entradas-title">ğŸ’° Entradas ({{ entradasDoMes.length }})</div>
          </div>
          <div class="entradas-list">
            <div *ngFor="let entrada of entradasDoMes.slice(0, 4)" class="entrada-item">
              <div class="entrada-fonte">{{ entrada.fonte }}</div>
              <div class="entrada-valor">{{ formatarMoeda(entrada.valor) }}</div>
            </div>
          </div>
        </div>
        
      </div>
      
      <!-- LAYOUT DESKTOP ORIGINAL (oculto no mobile) -->
      <div class="compact-grid-top">
        <!-- Card de despesas com alertas integrados -->
        <div class="compact-card despesas-compact">
        <div class="compact-header">
          <h4>ğŸ“‹ Despesas</h4>
          <span class="count-badge">{{ despesasDoMes.length }}</span>
        </div>
        <div class="compact-content">
          <!-- Lista de despesas (reduzida) -->
          <div class="despesas-mini-list">
            <div *ngFor="let despesa of despesasDoMes.slice(0, 3)" 
                 class="mini-despesa" 
                 [ngClass]="getDespesaStatusClass(despesa)">
              <span class="mini-icon">{{ despesa.categoria.icon }}</span>
              <span class="mini-desc">{{ despesa.descricao }}</span>
              <span class="mini-value">{{ formatarMoeda(despesa.valor) }}</span>
              <span class="mini-status">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
            </div>
          </div>
        </div>
        
        <!-- SeÃ§Ã£o de alertas compacta e descritiva -->
        <div class="alerts-section compact">
          <div class="alerts-header">
            <div class="alerts-header-left">
              <span class="alerts-title">âš ï¸ Alertas</span>
              <span class="alerts-count" *ngIf="getTotalAlertas() > 0">{{ getTotalAlertas() }}</span>
            </div>
            <div class="alerts-header-controls">
              <button class="btn btn-sm btn-link" (click)="openAlertsModal()" aria-label="Ver todos os alertas">Ver todos</button>
            </div>
          </div>
          
          <!-- Alertas mais descritivos e compactos -->
          <div class="alerts-list">
            <!-- Despesas vencidas -->
            <div *ngFor="let despesa of despesasVencidas.slice(0, 1)" class="alert-item vencida">
              <span class="alert-emoji">ğŸ”´</span>
              <div class="alert-info">
                <span class="alert-desc">{{ despesa.descricao }}</span>
                <span class="alert-date">Venceu {{ getDiasVencimento(despesa) }}</span>
              </div>
              <span class="alert-amount">{{ formatarMoeda(despesa.valor) }}</span>
            </div>
            
            <!-- Despesas prÃ³ximas ao vencimento -->
            <div *ngFor="let despesa of despesasProximasVencimento.slice(0, 1)" class="alert-item proxima">
              <span class="alert-emoji">ğŸŸ¡</span>
              <div class="alert-info">
                <span class="alert-desc">{{ despesa.descricao }}</span>
                <span class="alert-date">Vence {{ getDiasParaVencimento(despesa) }}</span>
              </div>
              <span class="alert-amount">{{ formatarMoeda(despesa.valor) }}</span>
            </div>
            
            <!-- Meta de gastos (sempre visÃ­vel) -->
            <div class="alert-item meta"
                 [ngClass]="{
                   'exceeded': getPercentualMetaUsada() >= 100,
                   'warn': getPercentualMetaUsada() >= metaWarnThreshold && getPercentualMetaUsada() < 100,
                   'ok': getPercentualMetaUsada() < metaWarnThreshold
                 }">
              <span class="alert-emoji">ğŸ“Š</span>
              <div class="alert-info">
                <span class="alert-desc">Meta de gastos</span>
                <span class="alert-date">Meta: {{ gastoMetaPercentualGeral }}% das entradas (R$ {{ formatarMoeda(getMetaBudgetValor()) }})</span>
                <span class="alert-date">Gasto atual: {{ formatarMoeda(resumo.totalDespesas) }} â€” Restante: {{ formatarMoeda(getMetaBudgetValor() - resumo.totalDespesas) }}</span>

                <div class="meta-progress" aria-hidden="false">
                  <div class="meta-progress-bar"
                       role="progressbar"
                       [attr.aria-valuenow]="getPercentualMetaUsada()"
                       aria-valuemin="0"
                       aria-valuemax="100"
                       [style.width.%]="getMetaProgressWidth()"></div>
                </div>

                <small class="alert-sub">{{ getPercentualMetaUsada() }}% da meta usada</small>
              </div>
              <span class="alert-amount">{{ formatarMoeda(resumo.totalDespesas) }}</span>
            </div>

            <!-- Meta do mÃªs atual (mesmo esquema) -->
            <div class="alert-item meta meta-month"
                 [ngClass]="{
                   'exceeded': getPercentualMetaUsadaMesAtual() >= 100,
                   'warn': getPercentualMetaUsadaMesAtual() >= metaWarnThreshold && getPercentualMetaUsadaMesAtual() < 100,
                   'ok': getPercentualMetaUsadaMesAtual() < metaWarnThreshold
                 }">
              <span class="alert-emoji">ğŸ—“ï¸</span>
              <div class="alert-info">
                <span class="alert-desc">Meta do mÃªs atual</span>
                <span class="alert-date">Meta: {{ gastoMetaPercentualMensal }}% das entradas do mÃªs (R$ {{ formatarMoeda(getMetaValorMesAtual()) }})</span>
                <span class="alert-date">Gasto atual (mÃªs): {{ formatarMoeda(getGastosDoMesTotal()) }} â€” Restante: {{ formatarMoeda(getMetaMesAtualRestante()) }}</span>

                <div class="meta-progress" aria-hidden="false">
                  <div class="meta-progress-bar"
                       role="progressbar"
                       [attr.aria-valuenow]="getPercentualMetaUsadaMesAtual()"
                       aria-valuemin="0"
                       aria-valuemax="100"
                       [style.width.%]="getMetaMesAtualProgressWidth()"></div>
                </div>

                <small class="alert-sub">{{ getPercentualMetaUsadaMesAtual() }}% da meta do mÃªs usada</small>
              </div>
              <span class="alert-amount">{{ formatarMoeda(getGastosDoMesTotal()) }}</span>
            </div>
            
            <!-- Quando nÃ£o hÃ¡ alertas -->
            <div *ngIf="getTotalAlertas() === 0" class="alert-item no-alerts">
              <span class="alert-emoji">âœ…</span>
              <div class="alert-info">
                <span class="alert-desc">Tudo em dia!</span>
                <span class="alert-date">Nenhuma pendÃªncia</span>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- Card de resumo com entradas integradas -->
      <div class="compact-card stats-compact">
        <div class="compact-header">
          <h4>ğŸ“ˆ Resumo</h4>
        </div>
        <div class="compact-content">
          <!-- EstatÃ­sticas principais -->
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-number">{{ contarDespesasPagas() }}</span>
              <span class="stat-label">Pagas</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ contarDespesasPendentes() }}</span>
              <span class="stat-label">Pendentes</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ despesasVencidas.length }}</span>
              <span class="stat-label">Vencidas</span>
            </div>
          </div>
          
          <!-- SeÃ§Ã£o de entradas integrada -->
          <div class="entradas-section">
            <div class="entradas-header">
              <span class="entradas-title">ğŸ’° Entradas ({{ entradasDoMes.length }})</span>
            </div>
            <div class="entradas-mini-list">
              <div *ngFor="let entrada of entradasDoMes.slice(0, 3)" class="mini-entrada-compact">
                <span class="entrada-fonte-compact">{{ entrada.fonte }}</span>
                <span class="entrada-valor-compact">{{ formatarMoeda(entrada.valor) }}</span>
              </div>
            </div>
          </div>
            <!-- Saldo evolution chart -->
            <div class="saldo-evolution" style="margin-top:12px;">
              <app-chart-line [dadosMensais]="dadosMensais" [projection]="getProjectionSaldo()"></app-chart-line>
            </div>
        </div>
        </div>
      </div>
      
      <!-- Segunda linha: GrÃ¡fico ocupando toda a largura -->
      <div class="compact-grid-bottom">
        <div class="compact-card chart-compact full-width">
          <div class="compact-header">
            <h4>ğŸ“Š Despesas por Categoria</h4>
            <span class="chart-summary">{{ despesasPorCategoria.length }} categorias</span>
          </div>
          <div class="compact-content chart-layout">
            <app-chart [despesasPorCategoria]="despesasPorCategoria" chartType="doughnut"></app-chart>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Layout ClÃ¡ssico (Sidebar + Main Content) -->
  <div *ngIf="currentTheme === 'classico' && !showDadosMensais" class="layout-container layout-classico">
    <div class="classico-wrapper">
      
      <!-- Sidebar clÃ¡ssica -->
      <aside class="classico-sidebar">
        <!-- Resumo financeiro -->
        <div class="sidebar-section financial-summary">
          <h3>ğŸ’° Resumo Financeiro</h3>
          <div class="summary-items">
            <div class="summary-item entrada">
              <div class="summary-icon">ğŸ’µ</div>
              <div class="summary-data">
                <span class="summary-label">Entradas</span>
                <span class="summary-value positive">{{ formatarMoeda(resumo.totalEntradas) }}</span>
              </div>
            </div>
            <div class="summary-item despesa">
              <div class="summary-icon">ğŸ’³</div>
              <div class="summary-data">
                <span class="summary-label">Despesas</span>
                <span class="summary-value negative">{{ formatarMoeda(resumo.totalDespesas) }}</span>
              </div>
            </div>
            <div class="summary-item saldo">
              <div class="summary-icon">ğŸ“Š</div>
              <div class="summary-data">
                <span class="summary-label">Saldo</span>
                <span class="summary-value" [ngClass]="getSaldoClass()">{{ formatarMoeda(resumo.saldoPrevisto) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- NavegaÃ§Ã£o -->
        <div class="sidebar-section navigation">
          <h3>ğŸ§­ NavegaÃ§Ã£o</h3>
          <div class="nav-buttons">
            <button class="nav-btn" (click)="irParaGestao()">
              <span class="nav-icon">ğŸ“‹</span>
              <span class="nav-text">Gerenciar</span>
            </button>
            <button class="nav-btn" (click)="mostrarDadosMensais()">
              <span class="nav-icon">ğŸ“ˆ</span>
              <span class="nav-text">RelatÃ³rios</span>
            </button>
          </div>
        </div>

        <!-- Alertas -->
        <div class="sidebar-section alerts" *ngIf="despesasVencidas.length > 0">
          <h3>âš ï¸ Alertas</h3>
          <div class="alert-list">
            <div *ngFor="let despesa of despesasVencidas.slice(0, 3)" class="alert-item">
              <span class="alert-badge">VENCIDA</span>
              <span class="alert-desc">{{ despesa.descricao }}</span>
              <span class="alert-value">{{ formatarMoeda(despesa.valor) }}</span>
            </div>
          </div>
        </div>

        <!-- EstatÃ­sticas -->
        <div class="sidebar-section stats">
          <h3>ğŸ“Š EstatÃ­sticas</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-value">{{ contarDespesasPagas() }}</span>
              <span class="stat-label">Pagas</span>
            </div>
            <div class="stat-card">
              <span class="stat-value">{{ contarDespesasPendentes() }}</span>
              <span class="stat-label">Pendentes</span>
            </div>
            <div class="stat-card">
              <span class="stat-value">{{ despesasPorCategoria.length }}</span>
              <span class="stat-label">Categorias</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- ConteÃºdo principal clÃ¡ssico -->
      <main class="classico-main">
        <!-- Header -->
        <div class="main-header">
          <div class="header-content">
            <h1>Dashboard Financeiro</h1>
            <p>VisÃ£o geral de suas finanÃ§as pessoais</p>
          </div>
          <div class="header-actions">
            <button class="classico-btn primary" (click)="irParaGestao()">+ Nova Despesa</button>
            <button class="classico-btn secondary" (click)="mostrarDadosMensais()">ğŸ“Š RelatÃ³rios</button>
          </div>
          <!-- Period selector in clÃ¡ssico header -->
          <div style="margin-left:16px; display:flex; align-items:center; gap:10px;">
            <label style="font-size:13px;color:var(--muted);">PerÃ­odo:</label>
            <select [(ngModel)]="selectedPeriodMonths" (change)="onPeriodChange()" class="select-period-classico">
              <option *ngFor="let opt of periodOptions" [value]="opt.value">{{ opt.label }}</option>
            </select>
            <div style="margin-left:12px; text-align:left;">
              <div style="font-size:12px;color:var(--muted);">Despesas</div>
              <div style="font-weight:700">{{ formatarMoeda(periodMetrics.despesas || 0) }}</div>
            </div>
          </div>
        </div>

        <!-- ConteÃºdo principal -->
        <div class="main-content">
          <!-- GrÃ¡fico principal -->
          <div class="main-card chart-card">
            <div class="card-header">
              <h3>ğŸ“Š DistribuiÃ§Ã£o por Categoria</h3>
            </div>
            <div class="card-content">
              <app-chart [despesasPorCategoria]="despesasPorCategoria" chartType="pie"></app-chart>
            </div>
          </div>

          <!-- Tabela de despesas -->
          <div class="main-card table-card">
            <div class="card-header">
              <h3>ğŸ“‹ Registro de Despesas</h3>
              <span class="card-subtitle">{{ despesasDoMes.length }} registros</span>
            </div>
            <div class="card-content">
              <div class="classico-table">
                <div class="table-header">
                  <span>Categoria</span>
                  <span>DescriÃ§Ã£o</span>
                  <span>Valor</span>
                  <span>Status</span>
                </div>
                <div *ngFor="let despesa of despesasDoMes.slice(0, 8)" 
                     class="table-row" 
                     [ngClass]="getDespesaStatusClass(despesa)">
                  <span class="table-cell categoria">
                    <span class="categoria-icon">{{ despesa.categoria.icon }}</span>
                    {{ despesa.categoria.nome }}
                  </span>
                  <span class="table-cell">{{ despesa.descricao }}</span>
                  <span class="table-cell">{{ formatarMoeda(despesa.valor) }}</span>
                  <span class="table-cell">
                    <span class="status-badge" [ngClass]="despesa.paga ? 'paid' : 'pending'">
                      {{ despesa.paga ? 'Pago' : 'Pendente' }}
                    </span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- VisualizaÃ§Ã£o de Dados Mensais (comum para todos os layouts) -->
  <div *ngIf="showDadosMensais" class="monthly-data-view">
    
    <div class="monthly-header">
      <div class="title-section">
        <h2>ğŸ“… DADOS POR MÃŠS</h2>
        <p class="subtitle">Visualize dados organizados por perÃ­odo</p>
      </div>
      
      <div class="visualization-selector">
        <label>VisualizaÃ§Ã£o:</label>
        <select (change)="alterarVisualizacao(tiposVisualizacao[+($any($event.target).value)])" class="select-visualization">
          <option *ngFor="let tipo of tiposVisualizacao; let i = index" [value]="i" [selected]="visualizacaoAtiva.id === tipo.id">
            {{ tipo.nome }}
          </option>
        </select>
      </div>

      <!-- BotÃ£o para voltar ao dashboard -->
      <div class="back-section">
        <button class="back-btn" (click)="voltarAoDashboard()">â† Voltar ao Dashboard</button>
      </div>
    </div>

    <!-- VisualizaÃ§Ã£o Detalhada -->
    <div *ngIf="visualizacaoAtiva.id === 'detalhada'" class="detailed-view">
      
      <!-- Seletores de perÃ­odo -->
      <div class="period-selectors">
        <div class="selector-group">
          <label>MÃªs:</label>
          <select [(ngModel)]="mesSelecionado" (change)="alterarMesSelecionado()" class="period-select">
            <option *ngFor="let mes of meses" [value]="mes.valor">{{ mes.nome }}</option>
          </select>
        </div>
        
        <div class="selector-group">
          <label>Ano:</label>
          <select [(ngModel)]="anoSelecionado" (change)="alterarAnoSelecionado()" class="period-select">
            <option *ngFor="let ano of anos" [value]="ano">{{ ano }}</option>
          </select>
        </div>
      </div>

      <!-- Resumo do mÃªs -->
      <div class="month-summary">
        <h3>ğŸ“Š {{ getNomeMesSelecionado() }} de {{ anoSelecionado }}</h3>
        
        <div class="summary-cards">
          <div class="summary-card entrada">
            <div class="card-icon">ğŸ’°</div>
            <div class="card-content">
              <span class="card-label">Entradas</span>
              <span class="card-value">{{ formatarMoeda(resumoMesDetalhado.totalEntradas) }}</span>
            </div>
          </div>
          
          <div class="summary-card despesa">
            <div class="card-icon">ğŸ’¸</div>
            <div class="card-content">
              <span class="card-label">Despesas</span>
              <span class="card-value">{{ formatarMoeda(resumoMesDetalhado.totalDespesas) }}</span>
            </div>
          </div>
          
          <div class="summary-card saldo" [ngClass]="resumoMesDetalhado.saldo >= 0 ? 'positive' : 'negative'">
            <div class="card-icon">{{ resumoMesDetalhado.saldo >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</div>
            <div class="card-content">
              <span class="card-label">Saldo</span>
              <span class="card-value">{{ formatarMoeda(resumoMesDetalhado.saldo) }}</span>
            </div>
          </div>
        </div>

        <!-- Status das despesas -->
        <div class="status-summary">
          <div class="status-item paid">
            <span class="status-number">{{ resumoMesDetalhado.despesasPagas }}</span>
            <span class="status-label">Pagas</span>
          </div>
          <div class="status-item pending">
            <span class="status-number">{{ resumoMesDetalhado.despesasPendentes }}</span>
            <span class="status-label">Pendentes</span>
          </div>
          <div class="status-item overdue">
            <span class="status-number">{{ resumoMesDetalhado.despesasVencidas }}</span>
            <span class="status-label">Vencidas</span>
          </div>
        </div>
      </div>

      <!-- Listas detalhadas -->
      <div class="detailed-lists">
        
        <!-- Lista de entradas -->
        <div class="list-section" *ngIf="entradasDoMesDetalhado.length > 0">
          <h4>ğŸ’° Entradas de {{ getNomeMesSelecionado() }}</h4>
          <div class="items-list">
            <div *ngFor="let entrada of entradasDoMesDetalhado" class="list-item entrada">
              <div class="item-info">
                <span class="item-description">{{ entrada.descricao }}</span>
                <span class="item-source">{{ entrada.fonte }}</span>
              </div>
              <div class="item-values">
                <span class="item-date">{{ entrada.data | date:'dd/MM' }}</span>
                <span class="item-amount positive">{{ formatarMoeda(entrada.valor) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de despesas -->
        <div class="list-section" *ngIf="despesasDoMesDetalhado.length > 0">
          <h4>ğŸ’¸ Despesas de {{ getNomeMesSelecionado() }}</h4>
          <div class="items-list">
            <div *ngFor="let despesa of despesasDoMesDetalhado" class="list-item despesa">
              <div class="item-info">
                <span class="item-description">{{ despesa.descricao }}</span>
                <span class="item-category">{{ despesa.categoria.icon }} {{ despesa.categoria.nome }}</span>
              </div>
              <div class="item-values">
                <span class="item-date">{{ despesa.dataVencimento | date:'dd/MM' }}</span>
                <span class="item-status" [ngClass]="despesa.paga ? 'paid' : 'pending'">
                  {{ despesa.paga ? 'âœ…' : 'â³' }}
                </span>
                <span class="item-amount negative">{{ formatarMoeda(despesa.valor) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensagem sem dados -->
        <div *ngIf="entradasDoMesDetalhado.length === 0 && despesasDoMesDetalhado.length === 0" class="no-data">
          <div class="no-data-icon">ğŸ“­</div>
          <h4>Nenhum dado encontrado</h4>
          <p>NÃ£o hÃ¡ entradas ou despesas registradas para {{ getNomeMesSelecionado() }} de {{ anoSelecionado }}.</p>
        </div>
      </div>
    </div>

    <!-- VisualizaÃ§Ã£o Resumida -->
    <div *ngIf="visualizacaoAtiva.id === 'resumida'" class="summary-view">
      <!-- ConteÃºdo da visualizaÃ§Ã£o resumida mantido do original -->
      
      <!-- GrÃ¡fico Comparativo -->
      <section class="comparative-chart">
        <h3>Comparativo Mensal - Entradas vs Despesas</h3>
        <app-chart-bar></app-chart-bar>
      </section>

      <!-- Cards mensais -->
      <section class="monthly-cards">
        <div *ngFor="let dado of dadosMensais" class="monthly-card">
          <div class="monthly-header">
            <h4>{{ dado.descricao }}</h4>
            <div class="monthly-values">
              <span class="income">+{{ formatarMoeda(dado.entradas) }}</span>
              <span class="expense">-{{ formatarMoeda(dado.despesas) }}</span>
            </div>
          </div>
          
          <div class="monthly-body">
            <div class="financial-item">
              <span class="label">Entradas:</span>
              <span class="value positive">{{ formatarMoeda(dado.entradas) }}</span>
            </div>
            
            <div class="financial-item">
              <span class="label">Despesas:</span>
              <span class="value negative">{{ formatarMoeda(dado.despesas) }}</span>
            </div>
            
            <div class="financial-item balance">
              <span class="label">Saldo:</span>
              <span class="value" [ngClass]="dado.saldo >= 0 ? 'positive' : 'negative'">
                {{ formatarMoeda(dado.saldo) }}
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- Destaques mensais -->
      <section class="monthly-highlights">
        <h3>ğŸ“ˆ Destaques do MÃªs</h3>
        <div class="highlights-grid">
          <div *ngFor="let destaque of destaquesMensais" class="highlight-item">
            <div class="highlight-value">{{ formatarMoeda(destaque.valor) }}</div>
            <div class="highlight-label">{{ destaque.descricao }}</div>
            <small class="highlight-month">{{ destaque.mes }}</small>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Dashboard Principal (apenas quando nÃ£o estÃ¡ na visualizaÃ§Ã£o mensal) -->
  <div *ngIf="!showDadosMensais && currentTheme !== 'compacto' && currentTheme !== 'classico' && currentTheme !== 'customizavel'" class="main-dashboard">
    <!-- ConteÃºdo do dashboard padrÃ£o mantido para compatibilidade -->
    
    <!-- Cards de Resumo -->
    <section class="summary-cards">
      <div class="card card-entradas">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>Entradas</h3>
          <p class="card-value">{{ formatarMoeda(resumo.totalEntradas) }}</p>
        </div>
      </div>

      <div class="card card-saldo">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>Saldo Previsto</h3>
          <p class="card-value" [ngClass]="getSaldoClass()">{{ formatarMoeda(resumo.saldoPrevisto) }}</p>
        </div>
      </div>

      <div class="card card-despesas">
        <div class="card-icon">ğŸ’³</div>
        <div class="card-content">
          <h3>Total Despesas</h3>
          <p class="card-value">{{ formatarMoeda(resumo.totalDespesas) }}</p>
        </div>
      </div>
    </section>

    <!-- PerÃ­odo e mÃ©tricas rÃ¡pidas -->
    <div class="period-controls" style="margin:12px 0; display:flex; align-items:center; gap:16px; flex-wrap:wrap;">
      <div class="period-select">
        <label style="margin-right:6px; font-weight:600;">PerÃ­odo:</label>
        <select [(ngModel)]="selectedPeriodMonths" (change)="onPeriodChange()" class="select-period">
          <option *ngFor="let opt of periodOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>
      </div>

      <div class="period-metrics" style="display:flex; gap:18px; align-items:center;">
        <div class="metric-brief">
          <div style="font-size:12px;color:var(--muted);">Despesas</div>
          <div style="font-weight:700">{{ formatarMoeda(periodMetrics.despesas || 0) }}</div>
          <small *ngIf="periodMetrics.despesasChange !== null" [ngClass]="{ 'positive': periodMetrics.despesasChange < 0, 'negative': periodMetrics.despesasChange > 0 }">
            {{ periodMetrics.despesasChange > 0 ? '+' + periodMetrics.despesasChange + '%' : (periodMetrics.despesasChange === 0 ? '0%' : periodMetrics.despesasChange + '%') }} vs anterior
          </small>
        </div>

        <div class="metric-brief" *ngIf="periodMetrics.topCategoryName">
          <div style="font-size:12px;color:var(--muted);">Maior categoria</div>
          <div style="font-weight:700">{{ periodMetrics.topCategoryName }}</div>
          <small>{{ formatarMoeda(periodMetrics.topCategoryValue || 0) }} ({{ periodMetrics.topCategoryPercent || 0 }}%)</small>
        </div>
      </div>
    </div>

    <!-- Alertas -->
    <div *ngIf="despesasProximasVencimento.length > 0" class="alertas proximas">
      <h4>ğŸ”” PrÃ³ximas ao Vencimento</h4>
      <div *ngFor="let despesa of despesasProximasVencimento" class="alerta-item proxima">
        {{ despesa.descricao }} - {{ formatarMoeda(despesa.valor) }} - Vence: {{ formatarData(despesa.dataVencimento) }}
      </div>
    </div>

    <!-- ConteÃºdo Principal -->
    <div class="main-content">
      <!-- Cards lado a lado -->
      <div class="cards-lado-a-lado">
        <!-- Card do GrÃ¡fico de Despesas -->
        <section class="card-grafico">
          <div class="card-body">
            <app-chart [despesasPorCategoria]="despesasPorCategoria" chartType="pie"></app-chart>
          </div>
        </section>

        <!-- Card das Despesas do MÃªs -->
        <section class="card-despesas-mes">
          <div class="card-header">
            <h3>ğŸ“‹ Despesas do MÃªs Atual</h3>
            <div class="card-actions">
              <div class="view-toggle">
                <button 
                  class="toggle-btn" 
                  [class.active]="modoVisualizacaoDespesas === 'grade'"
                  (click)="alterarVisualizacaoDespesas('grade')"
                  title="VisualizaÃ§Ã£o em Grade">
                  âŠ Grade
                </button>
                <button 
                  class="toggle-btn" 
                  [class.active]="modoVisualizacaoDespesas === 'lista'"
                  (click)="alterarVisualizacaoDespesas('lista')"
                  title="VisualizaÃ§Ã£o em Lista">
                  â˜° Lista
                </button>
              </div>
              <span class="total-count">{{ despesasDoMes.length }} despesas</span>
              <button class="btn btn-primary" (click)="irParaGestao()">â• Nova Despesa</button>
            </div>
          </div>
          
          <div class="card-body">
            <!-- VisualizaÃ§Ã£o em Grade -->
            <div *ngIf="modoVisualizacaoDespesas === 'grade'">
              <div class="despesas-grid-otimizada" *ngIf="despesasDoMes.length > 0; else noDespesas">
                <div *ngFor="let despesa of despesasDoMes" class="despesa-card-compact" [ngClass]="getDespesaStatusClass(despesa)">
                <div class="despesa-header-compact">
                  <div class="categoria-info">
                    <div class="categoria-icon-compact" [style.background-color]="despesa.categoria.cor">
                      {{ despesa.categoria.icon || 'ğŸ’³' }}
                    </div>
                    <span class="categoria-nome-compact">{{ despesa.categoria.nome }}</span>
                  </div>
                  
                  <div class="despesa-actions-compact">
                    <button class="action-btn-compact edit-btn" (click)="editarDespesa(despesa)" title="Editar">
                      âœï¸
                    </button>
                    <button class="action-btn-compact delete-btn" (click)="excluirDespesa(despesa)" title="Excluir">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
                
                <div class="despesa-body-compact">
                  <h4 class="despesa-descricao-compact" [title]="despesa.descricao">{{ despesa.descricao }}</h4>
                  
                  <div class="info-grid">
                    <div class="info-row">
                      <span class="info-label-compact">ğŸ’°</span>
                      <span class="info-value-compact valor">{{ formatarMoeda(despesa.valor) }}</span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label-compact">ğŸ“…</span>
                      <span class="info-value-compact" [ngClass]="getVencimentoClass(despesa)">
                        {{ formatarData(despesa.dataVencimento) }}
                      </span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label-compact">âš¡</span>
                      <span class="info-value-compact prioridade-compact" [ngClass]="getPrioridadeClass(despesa.prioridade)">
                        {{ getPrioridadeTexto(despesa.prioridade) }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="status-footer">
                    <button class="status-toggle-compact" 
                            [ngClass]="despesa.paga ? 'pago' : 'pendente'"
                            (click)="toggleStatusPagamento(despesa)">
                      <span class="status-icon-compact">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
                      <span class="status-text-compact">{{ despesa.paga ? 'Pago' : 'Pendente' }}</span>
                    </button>
                  </div>
                </div>
              </div>
              </div>
            </div>

            <!-- VisualizaÃ§Ã£o em Lista -->
            <div *ngIf="modoVisualizacaoDespesas === 'lista'">
              <div class="despesas-lista" *ngIf="despesasDoMes.length > 0; else noDespesas">
              <div class="lista-header">
                <div class="header-col col-categoria">Categoria</div>
                <div class="header-col col-descricao">DescriÃ§Ã£o</div>
                <div class="header-col col-valor">Valor</div>
                <div class="header-col col-vencimento">Vencimento</div>
                <div class="header-col col-prioridade">Prioridade</div>
                <div class="header-col col-status">Status</div>
                <div class="header-col col-acoes">AÃ§Ãµes</div>
              </div>
              
              <div class="lista-body">
                <div *ngFor="let despesa of despesasDoMes" class="despesa-row" [ngClass]="getDespesaStatusClass(despesa)">
                  <div class="row-col col-categoria">
                    <div class="categoria-compact">
                      <div class="categoria-icon-small" [style.background-color]="despesa.categoria.cor">
                        {{ despesa.categoria.icon || 'ğŸ’³' }}
                      </div>
                      <span class="categoria-nome-small">{{ despesa.categoria.nome }}</span>
                    </div>
                  </div>
                  
                  <div class="row-col col-descricao">
                    <span class="despesa-descricao-compact" [title]="despesa.descricao">
                      {{ despesa.descricao }}
                    </span>
                  </div>
                  
                  <div class="row-col col-valor">
                    <span class="valor-compact">{{ formatarMoeda(despesa.valor) }}</span>
                  </div>
                  
                  <div class="row-col col-vencimento">
                    <span class="vencimento-compact" [ngClass]="getVencimentoClass(despesa)">
                      {{ formatarData(despesa.dataVencimento) }}
                    </span>
                  </div>
                  
                  <div class="row-col col-prioridade">
                    <span class="prioridade-compact" [ngClass]="getPrioridadeClass(despesa.prioridade)">
                      {{ getPrioridadeTexto(despesa.prioridade) }}
                    </span>
                  </div>
                  
                  <div class="row-col col-status">
                    <button class="status-toggle-compact" 
                            [ngClass]="despesa.paga ? 'pago' : 'pendente'"
                            (click)="toggleStatusPagamento(despesa)"
                            [title]="despesa.paga ? 'Despesa paga' : 'Marcar como pago'">
                      <span class="status-icon-compact">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
                    </button>
                  </div>
                  
                  <div class="row-col col-acoes">
                    <div class="acoes-compact">
                      <button class="action-btn-compact edit-btn" (click)="editarDespesa(despesa)" title="Editar">
                        âœï¸
                      </button>
                      <button class="action-btn-compact delete-btn" (click)="excluirDespesa(despesa)" title="Excluir">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              </div>
            </div>
            
            <ng-template #noDespesas>
              <div class="no-despesas">
                <div class="no-despesas-icon">ğŸ“</div>
                <h4>Nenhuma despesa cadastrada</h4>
                <p>Adicione suas despesas para comeÃ§ar o controle financeiro</p>
                <button class="btn btn-primary" (click)="irParaGestao()">â• Adicionar Primeira Despesa</button>
              </div>
            </ng-template>
          </div>
        </section>
      </div>

    <!-- Alertas de Vencimento -->
    <div *ngIf="despesasVencidas.length > 0" class="alertas vencidas">
      <h4>âš ï¸ Despesas Vencidas</h4>
      <div *ngFor="let despesa of despesasVencidas" class="alerta-item vencida">
        {{ despesa.descricao }} - {{ formatarMoeda(despesa.valor) }}
      </div>
    </div>

    <!-- Mural de AnotaÃ§Ãµes -->
    <section class="mural-anotacoes" [class.minimizado]="!mostrarMuralAnotacoes">
      <div class="mural-header">
        <div class="mural-title">
          <h3>ğŸ“ Mural de AnotaÃ§Ãµes</h3>
          <span class="contador-anotacoes">{{ anotacoes.length }} anotaÃ§Ãµes</span>
        </div>
        <div class="mural-controls">
          <button 
            class="btn-toggle-mural" 
            (click)="toggleMuralAnotacoes()"
            [title]="mostrarMuralAnotacoes ? 'Minimizar mural' : 'Expandir mural'">
            {{ mostrarMuralAnotacoes ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      <div *ngIf="mostrarMuralAnotacoes" class="mural-content">
        <!-- FormulÃ¡rio para nova anotaÃ§Ã£o -->
        <div class="nova-anotacao-form">
          <div class="input-group">
            <textarea 
              [(ngModel)]="novaAnotacao"
              placeholder="Digite sua anotaÃ§Ã£o aqui... (Ctrl+Enter para salvar)"
              class="nova-anotacao-input"
              rows="3"
              maxlength="500"
              (keydown.control.enter)="adicionarAnotacao()">
            </textarea>
            <div class="input-actions">
              <span class="char-counter">{{ novaAnotacao.length }}/500</span>
              <button 
                class="btn btn-primary btn-add-anotacao" 
                (click)="adicionarAnotacao()"
                [disabled]="!novaAnotacao.trim()">
                â• Adicionar
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de anotaÃ§Ãµes -->
        <div class="anotacoes-container" *ngIf="anotacoes.length > 0; else semAnotacoes">
          <div 
            *ngFor="let anotacao of anotacoes; trackBy: trackByAnotacao" 
            class="anotacao-card"
            [style.border-left-color]="anotacao.cor">
            
            <!-- Modo visualizaÃ§Ã£o -->
            <div *ngIf="editandoAnotacao !== anotacao.id" class="anotacao-view">
              <div class="anotacao-content">
                <p class="anotacao-texto">{{ anotacao.texto }}</p>
                <div class="anotacao-meta">
                  <span class="anotacao-data">{{ formatarDataHora(anotacao.dataHora) }}</span>
                  <div class="anotacao-actions">
                    <button 
                      class="btn-action edit" 
                      (click)="iniciarEdicao(anotacao)"
                      title="Editar anotaÃ§Ã£o">
                      âœï¸
                    </button>
                    <button 
                      class="btn-action delete" 
                      (click)="removerAnotacao(anotacao.id)"
                      title="Remover anotaÃ§Ã£o">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modo ediÃ§Ã£o -->
            <div *ngIf="editandoAnotacao === anotacao.id" class="anotacao-edit">
              <textarea 
                [(ngModel)]="textoEdicao"
                class="edit-textarea"
                rows="3"
                maxlength="500"
                (keydown.control.enter)="salvarEdicao()"
                (keydown.escape)="cancelarEdicao()">
              </textarea>
              <div class="edit-actions">
                <span class="char-counter">{{ textoEdicao.length }}/500</span>
                <div class="edit-buttons">
                  <button 
                    class="btn btn-success btn-sm" 
                    (click)="salvarEdicao()"
                    [disabled]="!textoEdicao.trim()">
                    âœ… Salvar
                  </button>
                  <button 
                    class="btn btn-secondary btn-sm" 
                    (click)="cancelarEdicao()">
                    âŒ Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado vazio -->
        <ng-template #semAnotacoes>
          <div class="sem-anotacoes">
            <div class="sem-anotacoes-icon">ğŸ“‹</div>
            <h4>Nenhuma anotaÃ§Ã£o ainda</h4>
            <p>Adicione suas primeiras anotaÃ§Ãµes para organizar ideias e lembretes</p>
          </div>
        </ng-template>
      </div>
    </section>
  </div>
</div>