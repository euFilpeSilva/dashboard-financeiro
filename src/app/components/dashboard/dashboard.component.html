<div class="dashboard">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1>ğŸ’° PLANEJAMENTO FINANCEIRO</h1>
        <h2>ğŸ“Š DASHBOARD FINANCEIRO</h2>
      </div>
      
      <div class="header-right">
        <div class="theme-selector">
          <label for="theme-select">Tema:</label>
          <select id="theme-select" (change)="alterarTema($any($event.target).value)" [value]="temaAtual">
            <option *ngFor="let tema of temasDisponiveis" [value]="tema.id">
              {{ tema.nome }}
            </option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="navigation">
      <button class="nav-btn" [class.active]="!showDespesaList && !showDadosMensais" (click)="voltarDashboard()">
        ğŸ“Š Dashboard
      </button>
      <button class="nav-btn" [class.active]="showDadosMensais" (click)="mostrarDadosMensais()">
        ğŸ“… Dados por MÃªs
      </button>
      <button class="nav-btn" [class.active]="showDespesaList" (click)="mostrarDespesas()">
        ğŸ“‹ Gerenciar Despesas
      </button>
      <button class="nav-btn nav-btn-gestao" (click)="irParaGestao()">
        ğŸ’¼ GestÃ£o Completa
      </button>
    </div>
  </header>

  <!-- ConteÃºdo da GestÃ£o de Despesas -->
  <div *ngIf="showDespesaList" class="despesa-management">
    <app-despesa-list></app-despesa-list>
  </div>

  <!-- SeÃ§Ã£o Dados por MÃªs -->
  <div *ngIf="showDadosMensais" class="dados-mensais">
    
    <div class="dados-header">
      <div class="title-section">
        <h2>ğŸ“… DADOS POR MÃŠS</h2>
        <p class="subtitle">Visualize dados organizados por perÃ­odo</p>
      </div>
      
      <div class="visualization-selector">
        <label>VisualizaÃ§Ã£o:</label>
        <select (change)="alterarVisualizacao(tiposVisualizacao[+($any($event.target).value)])" class="select-visualization">
          <option *ngFor="let tipo of tiposVisualizacao; let i = index" [value]="i" [selected]="visualizacaoAtiva.id === tipo.id">
            {{ tipo.nome }}
          </option>
        </select>
      </div>
    </div>

    <!-- GrÃ¡fico Comparativo -->
    <section class="grafico-comparativo">
      <h3>Comparativo Mensal - Entradas vs Despesas</h3>
      <app-chart-bar></app-chart-bar>
    </section>

    <!-- Cards dos Meses -->
    <section class="cards-mensais">
      <div *ngFor="let dado of dadosMensais" class="card-mensal">
        <div class="card-mensal-header">
          <h4>{{ dado.descricao }}</h4>
          <div class="valores-resumo">
            <span class="entradas-valor">+R$ {{ dado.entradas.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</span>
            <span class="despesas-valor">-R$ {{ dado.despesas.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</span>
          </div>
        </div>
        
        <div class="card-mensal-body">
          <div class="item-financeiro">
            <span class="label">Entradas:</span>
            <span class="valor text-green">{{ formatarMoeda(dado.entradas) }}</span>
          </div>
          
          <div class="item-financeiro">
            <span class="label">Despesas:</span>
            <span class="valor text-red">{{ formatarMoeda(dado.despesas) }}</span>
          </div>
          
          <div class="item-financeiro saldo-item">
            <span class="label">Saldo:</span>
            <span class="valor" [ngClass]="dado.saldo >= 0 ? 'text-green' : 'text-red'">
              {{ formatarMoeda(dado.saldo) }}
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Destaques Mensais -->
    <section class="destaques-mensais">
      <h3>ğŸ“ˆ Destaques do MÃªs</h3>
      <div class="destaque-grid">
        <div *ngFor="let destaque of destaquesMensais" class="destaque-item">
          <div class="destaque-value">{{ formatarMoeda(destaque.valor) }}</div>
          <div class="destaque-label">{{ destaque.descricao }}</div>
          <small class="destaque-mes">{{ destaque.mes }}</small>
        </div>
      </div>
    </section>
  </div>

  <!-- ConteÃºdo do Dashboard -->
  <div *ngIf="!showDespesaList && !showDadosMensais">
    <!-- Cards de Resumo -->
    <section class="summary-cards">
      <div class="card card-entradas">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>Entradas</h3>
          <p class="card-value">{{ formatarMoeda(resumo.totalEntradas) }}</p>
        </div>
      </div>

      <div class="card card-saldo">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>Saldo Previsto</h3>
          <p class="card-value" [ngClass]="getSaldoClass()">{{ formatarMoeda(resumo.saldoPrevisto) }}</p>
        </div>
      </div>

      <div class="card card-despesas">
        <div class="card-icon">ğŸ’³</div>
        <div class="card-content">
          <h3>Total Despesas</h3>
          <p class="card-value">{{ formatarMoeda(resumo.totalDespesas) }}</p>
        </div>
      </div>
    </section>

    <!-- PerÃ­odo Atual -->
    <!-- <section class="periodo-atual">
      <h3>{{ periodoAtual.descricao }}</h3>
    </section> -->

        <div *ngIf="despesasProximasVencimento.length > 0" class="alertas proximas">
      <h4>ğŸ”” PrÃ³ximas ao Vencimento</h4>
      <div *ngFor="let despesa of despesasProximasVencimento" class="alerta-item proxima">
        {{ despesa.descricao }} - {{ formatarMoeda(despesa.valor) }} - Vence: {{ formatarData(despesa.dataVencimento) }}
      </div>
    </div>

    <!-- ConteÃºdo Principal -->
    <div class="main-content">
      <!-- Cards lado a lado -->
      <div class="cards-lado-a-lado">
        <!-- Card do GrÃ¡fico de Despesas -->
        <section class="card-grafico">
          <div class="card-body">
            <app-chart [despesasPorCategoria]="despesasPorCategoria" chartType="pie"></app-chart>
          </div>
        </section>

        <!-- Card das Despesas do MÃªs -->
        <section class="card-despesas-mes">
          <div class="card-header">
            <h3>ğŸ“‹ Despesas do MÃªs Atual</h3>
            <div class="card-actions">
              <div class="view-toggle">
                <button 
                  class="toggle-btn" 
                  [class.active]="modoVisualizacaoDespesas === 'grade'"
                  (click)="alterarVisualizacaoDespesas('grade')"
                  title="VisualizaÃ§Ã£o em Grade">
                  âŠ Grade
                </button>
                <button 
                  class="toggle-btn" 
                  [class.active]="modoVisualizacaoDespesas === 'lista'"
                  (click)="alterarVisualizacaoDespesas('lista')"
                  title="VisualizaÃ§Ã£o em Lista">
                  â˜° Lista
                </button>
              </div>
              <span class="total-count">{{ despesasDoMes.length }} despesas</span>
              <button class="btn btn-primary" (click)="mostrarDespesas()">â• Nova Despesa</button>
            </div>
          </div>
          
          <div class="card-body">
            <!-- VisualizaÃ§Ã£o em Grade -->
            <div *ngIf="modoVisualizacaoDespesas === 'grade'">
              <div class="despesas-grid-otimizada" *ngIf="despesasDoMes.length > 0; else noDespesas">
                <div *ngFor="let despesa of despesasDoMes" class="despesa-card-compact" [ngClass]="getDespesaStatusClass(despesa)">
                <div class="despesa-header-compact">
                  <div class="categoria-info">
                    <div class="categoria-icon-compact" [style.background-color]="despesa.categoria.cor">
                      {{ despesa.categoria.icon || 'ğŸ’³' }}
                    </div>
                    <span class="categoria-nome-compact">{{ despesa.categoria.nome }}</span>
                  </div>
                  
                  <div class="despesa-actions-compact">
                    <button class="action-btn-compact edit-btn" (click)="editarDespesa(despesa)" title="Editar">
                      âœï¸
                    </button>
                    <button class="action-btn-compact delete-btn" (click)="excluirDespesa(despesa)" title="Excluir">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
                
                <div class="despesa-body-compact">
                  <h4 class="despesa-descricao-compact" [title]="despesa.descricao">{{ despesa.descricao }}</h4>
                  
                  <div class="info-grid">
                    <div class="info-row">
                      <span class="info-label-compact">ğŸ’°</span>
                      <span class="info-value-compact valor">{{ formatarMoeda(despesa.valor) }}</span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label-compact">ğŸ“…</span>
                      <span class="info-value-compact" [ngClass]="getVencimentoClass(despesa)">
                        {{ formatarData(despesa.dataVencimento) }}
                      </span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label-compact">âš¡</span>
                      <span class="info-value-compact prioridade-compact" [ngClass]="getPrioridadeClass(despesa.prioridade)">
                        {{ getPrioridadeTexto(despesa.prioridade) }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="status-footer">
                    <button class="status-toggle-compact" 
                            [ngClass]="despesa.paga ? 'pago' : 'pendente'"
                            (click)="toggleStatusPagamento(despesa)">
                      <span class="status-icon-compact">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
                      <span class="status-text-compact">{{ despesa.paga ? 'Pago' : 'Pendente' }}</span>
                    </button>
                  </div>
                </div>
              </div>
              </div>
            </div>

            <!-- VisualizaÃ§Ã£o em Lista -->
            <div *ngIf="modoVisualizacaoDespesas === 'lista'">
              <div class="despesas-lista" *ngIf="despesasDoMes.length > 0; else noDespesas">
              <div class="lista-header">
                <div class="header-col col-categoria">Categoria</div>
                <div class="header-col col-descricao">DescriÃ§Ã£o</div>
                <div class="header-col col-valor">Valor</div>
                <div class="header-col col-vencimento">Vencimento</div>
                <div class="header-col col-prioridade">Prioridade</div>
                <div class="header-col col-status">Status</div>
                <div class="header-col col-acoes">AÃ§Ãµes</div>
              </div>
              
              <div class="lista-body">
                <div *ngFor="let despesa of despesasDoMes" class="despesa-row" [ngClass]="getDespesaStatusClass(despesa)">
                  <div class="row-col col-categoria">
                    <div class="categoria-compact">
                      <div class="categoria-icon-small" [style.background-color]="despesa.categoria.cor">
                        {{ despesa.categoria.icon || 'ğŸ’³' }}
                      </div>
                      <span class="categoria-nome-small">{{ despesa.categoria.nome }}</span>
                    </div>
                  </div>
                  
                  <div class="row-col col-descricao">
                    <span class="despesa-descricao-compact" [title]="despesa.descricao">
                      {{ despesa.descricao }}
                    </span>
                  </div>
                  
                  <div class="row-col col-valor">
                    <span class="valor-compact">{{ formatarMoeda(despesa.valor) }}</span>
                  </div>
                  
                  <div class="row-col col-vencimento">
                    <span class="vencimento-compact" [ngClass]="getVencimentoClass(despesa)">
                      {{ formatarData(despesa.dataVencimento) }}
                    </span>
                  </div>
                  
                  <div class="row-col col-prioridade">
                    <span class="prioridade-compact" [ngClass]="getPrioridadeClass(despesa.prioridade)">
                      {{ getPrioridadeTexto(despesa.prioridade) }}
                    </span>
                  </div>
                  
                  <div class="row-col col-status">
                    <button class="status-toggle-compact" 
                            [ngClass]="despesa.paga ? 'pago' : 'pendente'"
                            (click)="toggleStatusPagamento(despesa)"
                            [title]="despesa.paga ? 'Despesa paga' : 'Marcar como pago'">
                      <span class="status-icon-compact">{{ despesa.paga ? 'âœ…' : 'â³' }}</span>
                    </button>
                  </div>
                  
                  <div class="row-col col-acoes">
                    <div class="acoes-compact">
                      <button class="action-btn-compact edit-btn" (click)="editarDespesa(despesa)" title="Editar">
                        âœï¸
                      </button>
                      <button class="action-btn-compact delete-btn" (click)="excluirDespesa(despesa)" title="Excluir">
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              </div>
            </div>
            
            <ng-template #noDespesas>
              <div class="no-despesas">
                <div class="no-despesas-icon">ğŸ“</div>
                <h4>Nenhuma despesa cadastrada</h4>
                <p>Adicione suas despesas para comeÃ§ar o controle financeiro</p>
                <button class="btn btn-primary" (click)="mostrarDespesas()">â• Adicionar Primeira Despesa</button>
              </div>
            </ng-template>
          </div>
        </section>
      </div>

    <!-- Alertas de Vencimento -->
    <div *ngIf="despesasVencidas.length > 0" class="alertas vencidas">
      <h4>âš ï¸ Despesas Vencidas</h4>
      <div *ngFor="let despesa of despesasVencidas" class="alerta-item vencida">
        {{ despesa.descricao }} - {{ formatarMoeda(despesa.valor) }}
      </div>
    </div>

    <!-- Mural de AnotaÃ§Ãµes -->
    <section class="mural-anotacoes" [class.minimizado]="!mostrarMuralAnotacoes">
      <div class="mural-header">
        <div class="mural-title">
          <h3>ğŸ“ Mural de AnotaÃ§Ãµes</h3>
          <span class="contador-anotacoes">{{ anotacoes.length }} anotaÃ§Ãµes</span>
        </div>
        <div class="mural-controls">
          <button 
            class="btn-toggle-mural" 
            (click)="toggleMuralAnotacoes()"
            [title]="mostrarMuralAnotacoes ? 'Minimizar mural' : 'Expandir mural'">
            {{ mostrarMuralAnotacoes ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      <div *ngIf="mostrarMuralAnotacoes" class="mural-content">
        <!-- FormulÃ¡rio para nova anotaÃ§Ã£o -->
        <div class="nova-anotacao-form">
          <div class="input-group">
            <textarea 
              [(ngModel)]="novaAnotacao"
              placeholder="Digite sua anotaÃ§Ã£o aqui... (Ctrl+Enter para salvar)"
              class="nova-anotacao-input"
              rows="3"
              maxlength="500"
              (keydown.control.enter)="adicionarAnotacao()">
            </textarea>
            <div class="input-actions">
              <span class="char-counter">{{ novaAnotacao.length }}/500</span>
              <button 
                class="btn btn-primary btn-add-anotacao" 
                (click)="adicionarAnotacao()"
                [disabled]="!novaAnotacao.trim()">
                â• Adicionar
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de anotaÃ§Ãµes -->
        <div class="anotacoes-container" *ngIf="anotacoes.length > 0; else semAnotacoes">
          <div 
            *ngFor="let anotacao of anotacoes; trackBy: trackByAnotacao" 
            class="anotacao-card"
            [style.border-left-color]="anotacao.cor">
            
            <!-- Modo visualizaÃ§Ã£o -->
            <div *ngIf="editandoAnotacao !== anotacao.id" class="anotacao-view">
              <div class="anotacao-content">
                <p class="anotacao-texto">{{ anotacao.texto }}</p>
                <div class="anotacao-meta">
                  <span class="anotacao-data">{{ formatarDataHora(anotacao.dataHora) }}</span>
                  <div class="anotacao-actions">
                    <button 
                      class="btn-action edit" 
                      (click)="iniciarEdicao(anotacao)"
                      title="Editar anotaÃ§Ã£o">
                      âœï¸
                    </button>
                    <button 
                      class="btn-action delete" 
                      (click)="removerAnotacao(anotacao.id)"
                      title="Remover anotaÃ§Ã£o">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modo ediÃ§Ã£o -->
            <div *ngIf="editandoAnotacao === anotacao.id" class="anotacao-edit">
              <textarea 
                [(ngModel)]="textoEdicao"
                class="edit-textarea"
                rows="3"
                maxlength="500"
                (keydown.control.enter)="salvarEdicao()"
                (keydown.escape)="cancelarEdicao()">
              </textarea>
              <div class="edit-actions">
                <span class="char-counter">{{ textoEdicao.length }}/500</span>
                <div class="edit-buttons">
                  <button 
                    class="btn btn-success btn-sm" 
                    (click)="salvarEdicao()"
                    [disabled]="!textoEdicao.trim()">
                    âœ… Salvar
                  </button>
                  <button 
                    class="btn btn-secondary btn-sm" 
                    (click)="cancelarEdicao()">
                    âŒ Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado vazio -->
        <ng-template #semAnotacoes>
          <div class="sem-anotacoes">
            <div class="sem-anotacoes-icon">ğŸ“‹</div>
            <h4>Nenhuma anotaÃ§Ã£o ainda</h4>
            <p>Adicione suas primeiras anotaÃ§Ãµes para organizar ideias e lembretes</p>
          </div>
        </ng-template>
      </div>
    </section>
  </div>
</div>
